{% extends "_default/page.html.twig" %}

{% block content %}
    <div class="container">
        <header class="d-flex flex-column justify-content-center align-items-center text-center my-5 py-4" role="banner" style="min-height: 85vh">
            <div class="profile-image-container mb-4" aria-hidden="true">
                <img
                    src="{{ url(site.author.image|resize(256)) }}"
                    srcset="{{ url(site.author.image|resize(128)) }} 128w,
                            {{ url(site.author.image|resize(256)) }} 256w,
                            {{ url(site.author.image|resize(512)) }} 512w"
                    sizes="(max-width: 768px) 128px, 256px"
                    width="200"
                    height="200"
                    class="rounded-circle profile-image"
                    alt=""
                    aria-hidden="true"
                    decoding="async"
                    fetchpriority="high"
                >
            </div>

            <h1 class="display-4 fw-bold mb-3">
                {{ site.author.name }}
            </h1>

            {% if site.author.title %}
                <h2 class="h4 text-muted mb-4">
                    <span class="visually-hidden">Titre: </span>{{ site.author.title }}
                </h2>
            {% endif %}

            <div class="lead mb-5">
                {{ site.baseline|raw }}
            </div>

            <!-- Section Contact -->
            <div class="row justify-content-center">
                <div class="col-lg-8 text-center social-links d-flex justify-content-center gap-4 mb-5" role="list" aria-label="Réseaux sociaux">
                    {% for social in site.social %}
                        <div class="social-link p-2" role="listitem">
                            <a href="{{ social.url }}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="text-decoration-none"
                               aria-label="Me suivre sur {{ social.name|capitalize }} (nouvelle fenêtre)"
                            >
                                <i class="{{ social.icon }} fa-4x" aria-hidden="true"></i>
                                <span class="visually-hidden">{{ social.url }}</span>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </header>

        <!-- Last articles -->
        <section class="latest-posts py-5 border-top" aria-labelledby="latest-posts-heading">
            <h2 id="latest-posts-heading" class="h3 text-center mb-5">Last articles</h2>
            <div class="row g-4" role="list">
                {% set latest_posts = site.pages|filter(p => p.section == 'blog' and p.date <= date() and p.id != page.id)|sort_by_date|slice(0, 3) %}
                {% for post in latest_posts %}
                    <div class="col-md-4" role="listitem">
                        <article class="card h-100 shadow-sm">
                            {% if post.image is defined and post.image is not null %}
                                {% set post_image = asset(post.image) %}
                                <div class="ratio ratio-16x9">
                                    <img
                                        src="{{ url(post_image|resize(400, 225, 'cover')) }}"
                                        srcset="{{ url(post_image|resize(400, 225, 'cover')) }} 400w,
                                                {{ url(post_image|resize(800, 450, 'cover')) }} 800w"
                                        sizes="(max-width: 768px) 100vw, 400px"
                                        class="card-img-top object-fit-cover"
                                        alt=""
                                        loading="lazy"
                                        width="400"
                                        height="225"
                                        decoding="async"
                                        {% if loop.first %}
                                            fetchpriority="high"
                                        {% else %}
                                            fetchpriority="low"
                                        {% endif %}
                                    >
                                </div>
                            {% endif %}
                            <div class="card-body d-flex flex-column">
                                <h3 class="h5 card-title">
                                    <a href="{{ url(post) }}" class="text-decoration-none stretched-link"
                                    >
                                        <span class="visually-hidden">Read article: </span>{{ post.title }}
                                    </a>
                                </h3>
                                <div class="text-muted small mb-3">
                                    <time datetime="{{ post.date|date('c') }}">
                                        <span class="visually-hidden">Published at</span>{{ post.date|format_date('long') }}
                                    </time>
                                    <span class="mx-2" aria-hidden="true">•</span>
                                    {% set reading_time = (post.content|striptags|split(' ')|length / 200)|round %}
                                    {% if reading_time < 1 %}{% set reading_time = 1 %}{% endif %}
                                    <span class="reading-time">{{ reading_time }} minute reading</span>
                                    <meta content="PT{{ reading_time }}M">
                                </div>
                                <p class="card-text flex-grow-1">
                                    {{ post.excerpt|default('')|striptags }}
                                    <span class="visually-hidden">Read article "{{ post.title }}"</span>
                                </p>
                                <a href="{{ url(post) }}" class="btn btn-outline-primary mt-auto align-self-start"
                                   aria-label="Read article : {{ post.title }}">
                                    Read more <span class="visually-hidden">: {{ post.title }}</span>
                                </a>
                            </div>
                        </article>
                    </div>
                {% endfor %}
            </div>
            <div class="text-center mt-5">
                <a href="{{ url('blog/') }}" class="btn btn-primary" aria-label="View articles">
                    View articles <i class="fas fa-arrow-right ms-2" aria-hidden="true"></i>
                </a>
            </div>
        </section>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Person",
        "@id": "{{ url('', {canonical: true}) }}#person",
        "name": "{{ site.author.name }}",
        "url": "{{ url('', {canonical: true}) }}",
        "sameAs": [
            {% for social in site.social %}
                {% if social.name != 'email' %}"{{ social.url }}"{% if not loop.last %},{% endif %}{% endif %}
            {% endfor %}
        ],
        "jobTitle": "{{ site.author.title }}",
        "image": "{{ url(site.author.image|resize(512), {canonical: true}) }}",
        "description": "{{ site.description|e('js') }}",
        "worksFor": {
            "@type": "Organization",
            "name": "{{ site.title }}",
            "url": "{{ url('', {canonical: true}) }}"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ url('', {canonical: true}) }}"
        }
    }
    </script>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "url": "{{ url('', {canonical: true}) }}",
        "name": "{{ site.title }}",
        "description": "{{ site.description|e('js') }}",
        "publisher": {
            "@id": "{{ url('', {canonical: true}) }}#person"
        },
        "potentialAction": {
            "@type": "SearchAction",
            "target": "{{ url('search') }}?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>

    {% if latest_posts is defined %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Blog",
        "@id": "{{ url('blog/', {canonical: true}) }}#blog",
        "name": "Blog de {{ site.author.name }}",
        "description": "Articles sur {{ site.description|e('js') }}",
        "publisher": {
            "@id": "{{ url('', {canonical: true}) }}#person"
        },
        "blogPost": [
            {% for post in latest_posts %}
            {
                "@type": "BlogPosting",
                "headline": "{{ post.title|e('js') }}",
                "url": "{{ url(post, {canonical: true}) }}",
                "datePublished": "{{ post.date|date('c') }}",
                "dateModified": "{{ post.updated|default(post.date)|date('c') }}",
                "description": "{{ post.description|default(post.excerpt|striptags)|e('js') }}",
                "author": {
                    "@id": "{{ url('', {canonical: true}) }}#person"
                },
                "publisher": {
                    "@id": "{{ url('', {canonical: true}) }}#person"
                },
                "mainEntityOfPage": {
                    "@type": "WebPage",
                    "@id": "{{ url(post, {canonical: true}) }}"
                }{% if post.image is defined and post.image is not null %},
                "image": {
                    "@type": "ImageObject",
                    "url": "{{ url(asset(post.image), {canonical: true}) }}",
                    "width": "1200",
                    "height": "630"
                }{% endif %}
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ]
    }
    </script>
    {% endif %}
{% endblock %}
